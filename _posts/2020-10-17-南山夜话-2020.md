---
layout:     post                    # 使用的布局（不需要改）
title:      南山夜话               # 标题 
subtitle:   流水账             #副标题
date:       2020.10.17              # 时间
author:     Sajo                     # 作者
header-img: img/114518.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - 深夜随笔
---

# 两个月过去了

从开学以来 工作强度就高得离谱

> 1.10月份离职了
>
> 2.投了几家 找回面试的感觉
>
> 3.没有改正不健康的作息
>
> 4.和李少咕咕开始在校外生活
>
> 5.xxuan出资 打了个小鸡场
>
> 6.学习停滞中
>
> 7.极度贫困

## 离职

说实话 我对我实习公司的工作环境非常的满意

1155 基本不加班 实习生也有加班工资

除了工资低 没有任何缺点 同时也太休闲了（~~摸鱼能摸一天~~

但是随之而来的 是 **空虚**  相应的是网校的高强度工作填补了我的空虚

## 网校

这就导致自己 非常的忙 基本上这两个月是连轴转

同时发生了 网校招新 信安协会新机到店 

部署了信安协会的CTFd 让学弟部署了自动题目容器部署的swarm集群

让Xky成为了Redrocker 部署了Xky要用的OJ

让新进学弟部署了一个业务网关 172网段上网方便许多（~~说到底还是学弟给力~~

同时拓展了一些网校的基础设置 日志埋点采集和镜像仓库做好了

完成了自己从暑假鸽到现在的k8s集群部署（~~有鸡了才有动力~~

但是什么事都有痛苦的

### 补贴

从六月份至今 补贴都还没有到账 

都不说工资 自己垫付的部分还未收回 

感到上班的积极性收到了沉重打击

### 新学弟

虽然说已经习惯跟学弟对线了 

但是感觉没有正常与人交流能力的学弟是越来越多 

交流起来让人非常的**烦躁**

**用自己的脑子去思考一下教程上的一行指令仿佛对他们来说都非常困难**

如果不是遇到那个非常强的学弟 我觉得我大概已经抑郁了

### CI/CD

如果问我最近最痛苦的事情是什么

那一定是k8s集群的CI/CD搭建

之前想的是 为了实现全自动运维 虽然k8s对网校来说体量太大 但是能减少大量人肉运维的时间 还是值得的

所以虽然学长说没必要 但我还是打算推下去

部署都很简单 轻车熟路 以为自己在公司操作了这么多了 CI/CD的部署也不在话下

然后年轻人还是太年轻 它成为了我近乎一周的梦魇

#### 网络环境

网校的内网环境 部署什么都不方便 劳烦学弟搭了个业务网关之后解决

#### 存储卷

公司的集群上存储卷都是已经配置好的Ceph存储集群 网校如果也用的话 那就真的是重装上阵了

所以用了轻量的NFS存储类

但是 默认情况下 不会在NFS存储类上动态创建存储卷

花了一个下午 找到这个问题 配了一个**nfs-client-provisioner** 解决问题

#### 与Gitlab对接

网校已有的Gitlab是在集群外的一台物理机上

能和集群直接连接 但部署的runner始终无法连接到gitlab（后来证实了不是集群的问题 非本机的runner都无法注册成功）

在现有打包机的基础上 添加了一个专门用于docker镜像打包的runner

但是用docker:dind作为base 会遇到docker指令无法正常使用的问题

这是因为最新的docker默认是tcp模式 会遇到奇奇怪怪的权限问题

直接换成docker.sock就好

最蛋疼的是实现最后一公里

在现在的情况下 打包完docker镜像之后 需要将打包好的镜像推到集群上运行就好

实际上发生了

> 选择namespace
>
> 新建pod
>
> 配置Deployment
>
> 配置ingress

如果要实现完整的自动化体验 就需要写一套通用的配置文件 用载了kubectl的镜像去执行deploy的指令

难受就难受在 这些配置文件**实在是太难写了**

集群外kubectl操作集群的权限也很难配

预计还需要两周来完成

目前的妥协方案是 最后一步使用kuboard生成的curl脚本 能近似实现自动化的体验

但是第一次需要运维手动操作 与现有脚本CI/CD的体验是相同的

希望能迈进全自动化时代

##  缺钱

今天的年轻人 都很缺钱 大多是落后的生产力和旺盛的消费欲望中 消费欲望占了先锋

我 是因为早早开始提前消费 成为了当代大学生的代表（花呗 白条 信用卡）

看起来挣了很多钱 不过都是填补自己之前提前消费的内容而已

前几天摔坏了手机 恰逢iPhone12发布会 看着自己空空的荷包 发出了连手机都修不起的悲鸣

希望新的大学生看到这里 **不要提前消费**

如果实在想买东西 请思考 自己分期之后 **每个月能不能多挣自己分期该还的钱**

如果可以 买没有关系

如果没有 那**请克制自己的消费欲望**

希望大家都能有节制的消费 不要成为黎明前夕看着卡里**1.54元**余额**焦虑而睡不着觉**的**带专生**

## 冬天到了

希望大家有饭吃 有人爱 希望自己的经济状况能快点好起来

有需求的话 希望大家能赏口饭吃 [xxuan.icu](https://xxuan.icu)

![工人阶级](https://raw.githubusercontent.com/Sajotim/pic/master/%E5%B7%A5%E4%BA%BA%E9%98%B6%E7%BA%A7.jpg)

Sajo

2020.10.17 黎明

